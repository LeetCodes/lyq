<html>
<head>
<title>Lyq Options</title>
<link rel="stylesheet" type="text/css" href="css/options.css" />
<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript">
//<![CDATA[
var background = chrome.extension.getBackgroundPage();

var newConfigurator = function() {
	var that = {};

	that.configs = background.Configs;
	that.load = function(forceDefault) {
		var configs = background.Configs.load(forceDefault);
		$("input").each(function(){
			var e = $(this);
			var name = e.attr("name");
			if(name !== "" && configs[name]) {
				switch(e.attr("type")) {
					case "checkbox":
						e.attr("checked", (configs[name] === "on")?"true":"false");
						break;
					default:
						e.val(configs[name]);
						break;
				}
			}
		});
		if (forceDefault) {
			$("#message").stop().text("Options are reset to default.").show().css('opacity', '1.0').fadeOut(5000);
		}
	};
	that.save = function() {
		var configs = background.Configs.load();
		$("input").each(function(){
			var e = $(this);
			var name = e.attr("name");
			if(name !== "" && configs[name] !== undefined) {
				switch(e.attr("type")) {
					case "checkbox":
						configs[name] = e.attr("checked");
						break;
					default:
						configs[name] = e.val();
						break;
				}
			}
		});
		background.Configs.save(configs);
		$("#message").stop().text("Options saved.").show().css('opacity', '1.0').fadeOut(5000);
	};
	that.forceDefault = function() {
		that.load(true);
	};

	return that;
};

function isAuthenticated(callback) {
	chrome.extension.sendRequest({"request": "isAuthenticated"}, function(resp) {
		callback(resp);
	});
}

function signin() {
	background.signin(function(result) { showAction(); });
}

function signout() {
	background.signout();
	showAction();
}

function showAction() {
	isAuthenticated(function(resp) {
		if(resp) {
			$("#signin").hide();
			$("#signout").show();
		} else {
			$("#signin").show();
			$("#signout").hide();
		}
	});
}

var configs = newConfigurator();
$(function(){configs.load()});

showAction();

//]]>
</script>
</head>
<body>
<div id="header">
<h1>Lyq Options:</h1>
</div>
<div id="signin" style="display:none">
  <p>Lyq is not allowed to access your Twitter account. <a href="javascript:signin()">Sign in</a>.</p>
</div>
<div id="signout" style="display:none">
  <p><a href="javascript:signout()">Sign out</a>.</p>
</div>
<div id="main">
  <form>
	<fieldset>
	  <legend>URL sharing</legend>
	  <label>Tweets with URL</label>
	  <input type="checkbox" name="tweeturi"/><br/>
	</fieldset>
	<h2>Advanced settings</h2>
	<fieldset>
	  <legend>Bit.ly configuration</legend>
	  <label>Account</label>
	  <input type="text" name="bitly_login"/><br/>
	  <label>API key</label>
	  <input type="text" name="bitly_apiKey"/>
	</fieldset>
    <p>
	<input type="button" value="Save" onclick="configs.save();" />
    <input type="button" value="Reset" onclick="configs.load();" />
	<input type="button" value="Reset to default" onclick="configs.forceDefault();" />
	<span id="message"></span>
	</p>
  </form>
</div>
</body>
</html>
